@{
    ViewBag.Title = "Google Map";
}

<style type="text/css">
    #map_canvas {
        height: 400px;
        width: 90%;
    }
</style>

<!--引入 Google API-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.9&sensor=false"></script>

<script type="text/javascript">

    var mainIcon = {
        url: 'Icons/04.png',
        origin: new google.maps.Point(0, 0),
        anchor: new google.maps.Point(0, 32)
    };

    /* 規劃 */
    var directionsService = new google.maps.DirectionsService();
    var start = "台北市介壽國中";
    var end = "台北市台北科技大學";
    var waypoints = "台北市台北車站,台北市國父紀念館";
    //規畫路徑呈現選項
    var rendererOptions = {
        suppressMarkers: true
    };
    directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

    function init() {

        var mapDiv = document.getElementById('map_canvas');
        var map = new google.maps.Map(mapDiv, {
            center: new google.maps.LatLng(25.039941, 121.512812),
            zoom: 15,
            scaleControl: true,

            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        directionsDisplay.setMap(map);
        var distanceWidget = new DistanceWidget(map);
    }

    //規畫路徑
    function calcRoute() {
        if (!waypoints) return;

        var arrPoint = waypoints.split(",");

        //經過地點
        var waypts = [];
        for (var i = 0; i < arrPoint.length; i++) {
            waypts.push({
                location: arrPoint[i],
                stopover: true
            });
        }

        //規畫路徑請求
        var request = {
            origin: start,
            destination: end,
            waypoints: waypts,
            optimizeWaypoints: true,
            travelMode: google.maps.DirectionsTravelMode.WALKING
        };

        directionsService.route(request, function (response, status) {
            //規畫路徑回傳結果
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
            }
        });
        console.log("done!!");
    }

    function DistanceWidget(map) {
        this.set('map', map);
        this.set('position', map.getCenter());

        var marker = new google.maps.Marker({
            draggable: true,
            title: '移動我 !!',
            icon: mainIcon,

        });

        // Bind the marker map property to the DistanceWidget map property
        marker.bindTo('map', this);

        // Bind the marker position property to the DistanceWidget position
        // property
        marker.bindTo('position', this);
        google.maps.event.addListener(marker, 'dragend', function () { alert(marker.getPosition()); });
    }

    DistanceWidget.prototype = new google.maps.MVCObject();

    google.maps.event.addDomListener(window, 'load', init);
    google.maps.event.addDomListener(window, 'load', calcRoute);
</script>


<div id="map_canvas" class="map_canvas" aria-setsize="500"></div>
