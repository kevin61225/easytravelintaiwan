@model List<EasyTravelInTaiwan.Models.travellistplace>

@*@Html.Partial("_alerts")*@

@if (TempData["SaveSuccess"] != null)
{
    <div id="SaveAlert" class="alert alert-success">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>@TempData["SaveSuccess"]</strong>
    </div>
}

<div>詳細位置</div>
<div>
    <ul class="nav nav-pills nav-stacked" id="InputsWrapper">
        @foreach (EasyTravelInTaiwan.Models.maplatlng maplatlng in ViewBag.TravelListPlaces)
        {
            <li id="place.@maplatlng.sno">
                <a href="#">@maplatlng.pName<i class="icon-remove pull-right"></i></a>
            </li>
        }
    </ul>

</div>
<div>
    <button id="Save-List-Button" class="btn">儲存</button>
</div>


<script type="text/javascript">
    var selectedList;

    $("#InputsWrapper li i").hover(
        function () {
            $(this).removeClass("icon-remove");
            $(this).addClass("icon-remove-circle");
        },
        function () {
            $(this).removeClass("icon-remove-circle");
            $(this).addClass("icon-remove");
        }
    );

    $('#InputsWrapper li').click(function () {
        //if (e.button == 1) {
        var str = $(this).attr('id');
        var n = str.split(".");
        var id;
        for (var i = 0; i < gmarkers.length; i++) {
            if (gmarkers[i].gId == n[1]) {
                id = i;
            }
        }
        google.maps.event.trigger(gmarkers[id], "click");
        gmarkers[id].setVisible(true);
        //}
        //else if (e.button == 2) {
        //    var str = $(this).attr('id');
        //    var n = str.split("-");
        //    console.log(e.button);
        //}
    });

    $("#InputsWrapper li i").click(function (e) {

        var place = $(this).parent().parent().attr('id');
        var n = place.split(".");

        for (var i = 0; i < gmarkers.length; i++) {
            if (gmarkers[i].gId == n[1]) {
                gmarkers[i].isChecked = false;
            }
        }

        console.log(place);
        var $removeLi = $(this).parent().parent();

        $.ajax({
            type: "POST",
            url: "@Url.Action("DeletePlace")",
            data: JSON.stringify({ deletePlaceId: place }),
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data.Status != 2) {
                    $("#TravelListPlacePartialView").html(data);
                }
            }
        });
    });

    $('#Save-List-Button').click(function () {

        var placeItems = [];

        console.log("click");

        $("#InputsWrapper").children().each(function () {
            var $this = $(this);
            var str = $(this).attr('id');
            var n = str.split(".");
            var id;
            for (var i = 0; i < gmarkers.length; i++) {
                if (gmarkers[i].gId == n[1]) {
                    id = i;
                }
            }
            var item = { Tid: selectedList, sno: gmarkers[id].gId };
            placeItems.push(item);
        });

        $.ajax({
            type: "POST",
            url: "@Url.Action("PostPlace")",
            data: JSON.stringify(placeItems),
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $("#TravelListPlacePartialView").html(data);
                window.setTimeout(function () { $("#SaveAlert").fadeOut(); }, 10000);
            },
        });
    });

</script>
